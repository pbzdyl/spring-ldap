<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE article PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
"http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd">
<article>
  <title>Upgrade Guide</title>

  <para>The base package for Spring LDAP is
  <literal>org.springframework.ldap</literal>. In this document, we will refer
  to this package as <literal>ldap</literal>.</para>

  <sect1>
    <title>Upgrading from 1.1.x to 1.2-RC1</title>

    <para>In 1.2-RC1, there are a couple of major changes:</para>

    <itemizedlist>
      <listitem>
        <para>Transaction support added</para>
      </listitem>

      <listitem>
        <para>Exception hierarchy changed</para>
      </listitem>

      <listitem>
        <para>Package structure changed</para>
      </listitem>
    </itemizedlist>

    <para>The transaction support is entirely new should not affect users of
    previous releases.</para>

    <para>The exception hierarchy was previously based on the Spring
    <literal>DataAccessException</literal> hierarchy, but is now an unchecked
    mirror of the JNDI <literal>NamingException</literal> hierarchy. The fact
    that it is unchecked like <literal>DataAccessException</literal> makes
    migration less troublesome. However, note that
    <literal>ContextSource</literal> and its implementations now throw
    <literal>org.springframework.ldap.NamingException</literal>, not
    <literal>DataAccessException</literal>.</para>

    <para>In release 1.1.x, there were two cyclic dependencies. The first one
    was between <literal>ldap.support</literal> and
    <literal>ldap.support.parser</literal>, while the other one was between
    <literal>ldap</literal> and <literal>ldap.support</literal>. </para>

    <para>The first cycle was easily solved by changing the generation of the
    parser to generate code into <literal>ldap.support</literal> rather than
    into a separate package.</para>

    <para>The second cycle was slightly more complicated. To sort it out, some major
    restructuring was needed, as described in the following sections.</para>

    <para>While the package restructuring is rather extensive, no classes have
    changed names - this means that for the most cases a simple import resolve operation
    (such as &quot;Ctr+Shift-O&quot; in Eclipse) should sort things out. 
    You will still need to change the package names manually in your configuration files -
    this should be a simple find/replace operation based on the information below.</para>

    <sect2>
      <title>Moved core classes from ldap to ldap.core</title>

      <para>The core classes listed below were moved to a subpackage called
      <literal>ldap.core</literal>.</para>

      <para><informaltable>
          <tgroup cols="3">
            <colspec align="left" />

            <thead>
              <row>
                <entry align="center">Class</entry>

                <entry align="center">Before</entry>

                <entry align="center">After</entry>
              </row>
            </thead>

            <tbody>
              <row>
                <entry>AttributesMapper</entry>

                <entry>ldap</entry>

                <entry>ldap.core</entry>
              </row>

              <row>
                <entry>AuthenticationSource</entry>

                <entry>ldap</entry>

                <entry>ldap.core</entry>
              </row>

              <row>
                <entry>CollectingNameClassPair- CallbackHandler</entry>

                <entry>ldap</entry>

                <entry>ldap.core</entry>
              </row>

              <row>
                <entry>ContextAssembler</entry>

                <entry>ldap</entry>

                <entry>ldap.core</entry>
              </row>

              <row>
                <entry>ContextExecutor</entry>

                <entry>ldap</entry>

                <entry>ldap.core</entry>
              </row>

              <row>
                <entry>ContextMapper</entry>

                <entry>ldap</entry>

                <entry>ldap.core</entry>
              </row>

              <row>
                <entry>ContextSource</entry>

                <entry>ldap</entry>

                <entry>ldap.core</entry>
              </row>

              <row>
                <entry>DefaultNameClassPairMapper</entry>

                <entry>ldap</entry>

                <entry>ldap.core</entry>
              </row>

              <row>
                <entry>DirContextProcessor</entry>

                <entry>ldap</entry>

                <entry>ldap.core</entry>
              </row>

              <row>
                <entry>LdapOperations</entry>

                <entry>ldap</entry>

                <entry>ldap.core</entry>
              </row>

              <row>
                <entry>LdapTemplate</entry>

                <entry>ldap</entry>

                <entry>ldap.core</entry>
              </row>

              <row>
                <entry>NameClassPairCallbackHandler</entry>

                <entry>ldap</entry>

                <entry>ldap.core</entry>
              </row>

              <row>
                <entry>NameClassPairMapper</entry>

                <entry>ldap</entry>

                <entry>ldap.core</entry>
              </row>

              <row>
                <entry>SearchExecutor</entry>

                <entry>ldap</entry>

                <entry>ldap.core</entry>
              </row>
            </tbody>
          </tgroup>
        </informaltable></para>
    </sect2>

    <sect2>
      <title>Moved subpackages of ldap.support to ldap</title>

      <para>The various packages for authentication, controls and filters were
      moved to the top level <literal>ldap</literal> package.</para>

      <para><informaltable>
          <tgroup cols="3">
            <colspec align="center" />

            <thead>
              <row>
                <entry align="center">Class</entry>

                <entry align="center">Before</entry>

                <entry align="center">After</entry>
              </row>
            </thead>

            <tbody>
              <row>
                <entry>*</entry>

                <entry>ldap.support.authentication</entry>

                <entry>ldap.authentication</entry>
              </row>

              <row>
                <entry>*</entry>

                <entry>ldap.support.control</entry>

                <entry>ldap.control</entry>
              </row>

              <row>
                <entry>*</entry>

                <entry>ldap.support.filter</entry>

                <entry>ldap.filter</entry>
              </row>
            </tbody>
          </tgroup>
        </informaltable></para>
    </sect2>

    <sect2>
      <title>Moved most classes in ldap.support to ldap.core or
      ldap.core.support</title>

      <para>The classes in <literal>ldap.support</literal> that are directly
      referenced from the core classes were moved to
      <literal>ldap.core</literal>, while various support classes not directly
      referenced were moved to <literal>ldap.core.support</literal>.</para>

      <para><informaltable>
          <tgroup cols="3">
            <colspec align="left" />

            <thead>
              <row>
                <entry align="center">Class</entry>

                <entry align="center">Before</entry>

                <entry align="center">After</entry>
              </row>
            </thead>

            <tbody>
              <row>
                <entry>AbstractContextSource</entry>

                <entry>ldap.support</entry>

                <entry>ldap.core.support</entry>
              </row>

              <row>
                <entry>AggregateDirContextProcessor</entry>

                <entry>ldap.support</entry>

                <entry>ldap.core.support</entry>
              </row>

              <row>
                <entry>AttributeModificationsAware</entry>

                <entry>ldap.support</entry>

                <entry>ldap.core</entry>
              </row>

              <row>
                <entry>CountNameClassPair- CallbackHandler</entry>

                <entry>ldap.support</entry>

                <entry>ldap.core.support</entry>
              </row>

              <row>
                <entry>DefaultDirObjectFactory</entry>

                <entry>ldap.support</entry>

                <entry>ldap.core</entry>
              </row>

              <row>
                <entry>DefaultDnParserFactory</entry>

                <entry>ldap.support</entry>

                <entry>ldap.core</entry>
              </row>

              <row>
                <entry>DirContextAdapter</entry>

                <entry>ldap.support</entry>

                <entry>ldap.core</entry>
              </row>

              <row>
                <entry>DirContextOperations</entry>

                <entry>ldap.support</entry>

                <entry>ldap.core</entry>
              </row>

              <row>
                <entry>DirContextSource</entry>

                <entry>ldap.support</entry>

                <entry>ldap.core.support</entry>
              </row>

              <row>
                <entry>DistinguishedName</entry>

                <entry>ldap.support</entry>

                <entry>ldap.core</entry>
              </row>

              <row>
                <entry>DnParser</entry>

                <entry>ldap.support</entry>

                <entry>ldap.core</entry>
              </row>

              <row>
                <entry>LdapContextSource</entry>

                <entry>ldap.support</entry>

                <entry>ldap.core.support</entry>
              </row>

              <row>
                <entry>LdapEncoder</entry>

                <entry>ldap.support</entry>

                <entry>ldap.core</entry>
              </row>

              <row>
                <entry>LdapRdn</entry>

                <entry>ldap.support</entry>

                <entry>ldap.core</entry>
              </row>

              <row>
                <entry>LdapRdnComponent</entry>

                <entry>ldap.support</entry>

                <entry>ldap.core</entry>
              </row>
            </tbody>
          </tgroup>
        </informaltable></para>
    </sect2>

    <sect2>
      <title>Moved classes in ldap and ldap.util to ldap.support</title>

      <para>The <literal>ldap.util</literal> package has been removed. The
      classes in <literal>ldap.util</literal> were moved to
      <literal>ldap.support</literal>. Also, the classes in
      <literal>ldap</literal> related to exception translation were moved to
      <literal>ldap.support</literal>.</para>

      <note>
        <para>The translation classes are deprecated. Instead, the static
        method <literal>LdapUtils.convertLdapException </literal>should be
        used.</para>
      </note>

      <para><informaltable>
          <tgroup cols="3">
            <colspec align="left" />

            <thead>
              <row>
                <entry align="center">Class</entry>

                <entry align="center">Before</entry>

                <entry align="center">After</entry>
              </row>
            </thead>

            <tbody>
              <row>
                <entry><emphasis><emphasis>DefaultNamingExceptionTranslator</emphasis></emphasis></entry>

                <entry>ldap</entry>

                <entry>ldap.support</entry>
              </row>

              <row>
                <entry>LdapUtils</entry>

                <entry>-</entry>

                <entry>ldap.support</entry>
              </row>

              <row>
                <entry>ListComparator</entry>

                <entry>ldap.util</entry>

                <entry>ldap.support</entry>
              </row>

              <row>
                <entry><emphasis><emphasis>NamingExceptionTranslator</emphasis></emphasis></entry>

                <entry>ldap</entry>

                <entry>ldap.support</entry>
              </row>
            </tbody>
          </tgroup>
        </informaltable></para>
    </sect2>
  </sect1>
</article>